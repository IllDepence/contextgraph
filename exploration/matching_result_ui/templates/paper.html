<!doctype html>
<html>
<head>
<style>
article {
  margin: 0 auto;
  width: 70%;
  margin-top: 20px;
  margin-bottom: 20px;
}
span.method_used {
  background-color: #208fd1ff;
}
span.dataset_used {
  background-color: #f0a81dff;
}
span.task_used {
  background-color: #62f01dff;
}
span.method_named {
  background-color: #c7e4f6ff;
}
span.dataset_named {
  background-color: #fbebcbff;
}
span.task_named {
  background-color: #dafccaff;
}
span.cit_marker {
  background-color: #fab0cdff;
}
</style>
</head>
<body>
<section>
<article>
<h1><a href="https://arxiv.org/abs/{{ arxiv_id }}">{{ arxiv_id }}</a></h1>
{{ full_text|safe }}
</article>
<hr>
<article>
<h3>debug info</h3>
<pre>
{{ debug_str }}
</pre>
</article>
</section>
</body>
<script>
let trpls = {{ triples|safe }};
let datas_used = document.querySelectorAll('span.dataset_used');
let tasks_used = document.querySelectorAll('span.task_used');
// prepare span lookup dict dataset_name -> spans
let data_spans_dict = {};
for (i=0; i<datas_used.length; i++) {
  dataset_name = datas_used[i].textContent.toLowerCase();
  if (data_spans_dict[dataset_name] === undefined) {
    data_spans_dict[dataset_name] = [];
  }
  data_spans_dict[dataset_name].push(datas_used[i]);
}
// prepare span lookup dict task_name -> spans
let task_spans_dict = {};
for (i=0; i<tasks_used.length; i++) {
  task_name = tasks_used[i].textContent.toLowerCase();
  if (task_spans_dict[task_name] === undefined) {
    task_spans_dict[task_name] = [];
  }
  task_spans_dict[task_name].push(tasks_used[i]);
}
let task_to_data_dict = {};
let data_to_task_dict = {};
// prepare span lookup dicts task->dataset & dataset->task
for (i=0; i<trpls.length; i++) {
  task_name = trpls[i][0].toLowerCase();
  dataset_name = trpls[i][2].toLowerCase();
  if (task_to_data_dict[task_name] === undefined) {
    task_to_data_dict[task_name] = [];
  }
  task_to_data_dict[task_name].push(dataset_name);
  if (data_to_task_dict[dataset_name] === undefined) {
    data_to_task_dict[dataset_name] = [];
  }
  data_to_task_dict[dataset_name].push(task_name);
}
// highlight toggle function
function toggle_highlights_for(span) {
  on_style = "3px solid #f00";
  off_style = "";
  // where to look up targets
  if (span.className == 'dataset_used') {
    x_to_y_dict = data_to_task_dict;
    span_dict = task_spans_dict;
  }
  else if (span.className == 'task_used') {
    x_to_y_dict = task_to_data_dict;
    span_dict = data_spans_dict;
  }
  else {
    return;
  }
  // key for lookup
  signaling_entity_name = span.textContent.toLowerCase();
  highlight_targets = x_to_y_dict[signaling_entity_name];
  if (highlight_targets == undefined) { return; }
  for (i=0; i<highlight_targets.length; i++) {
    console.log('tggl: ' + span.textContent + ' -> ' + highlight_targets[i]);
    // lookup
    spans_to_highlight = span_dict[highlight_targets[i]];
    if (spans_to_highlight == undefined) { continue; }
    for (j=0; j<spans_to_highlight.length; j++) {
      target_span = spans_to_highlight[j];
      if (target_span.style.border == off_style) {
        target_span.style.border = on_style;
      }
      else if (target_span.style.border != off_style) {
        target_span.style.border = off_style;
      }
    }
  }
}
// set hover attributes
let all_used = document.querySelectorAll('span[class$=_used]');
for (i=0; i<all_used.length; i++) {
  all_used[i].onmouseover = function() {
    toggle_highlights_for(this);
  }
  all_used[i].onmouseout = function() {
    toggle_highlights_for(this);
  }
}
</script
</html>
